# =========================================================================
# Makefile
# =========================================================================
# autor: Mateusz Kruk, grupa 7.
# utworzony: 20.03.2021
# modyfikowany ostatnio: 27.03.2021
# =========================================================================

# =========================================================================
# Makrodefinicje
# =========================================================================

# -------------------------------------------------------------------------
# Nazwa zestawu
# -------------------------------------------------------------------------

MODULE := Zestaw02
NAME := Mateusz
SURNAME := Kruk

# -------------------------------------------------------------------------
# Nazwy zadań
# -------------------------------------------------------------------------

ZAD1A := drzewko1
ZAD1B := drzewko2
ZAD2A := macierzysty
ZAD2B := potomny
ZAD3A := zombi
ZAD3B := orphan
ZAD3C := execute

# -------------------------------------------------------------------------
# Nazwy plików wykonywalnych
# -------------------------------------------------------------------------

EXEC1A := $(ZAD1A).x
EXEC1B := $(ZAD1B).x
EXEC2A := $(ZAD2A).x
EXEC2B := $(ZAD2B).x
EXEC3A := $(ZAD3A).x
EXEC3B := $(ZAD3B).x
EXEC3C := $(ZAD3C).x

# -------------------------------------------------------------------------
# Makrodefinicje kompilacji i linkowania
# -------------------------------------------------------------------------

CC := gcc
CFLAGS := -O3 -Wall
LDFLAGS := -s -lm
LDLIBS :=
PROCINFO := procinfo.o

# =========================================================================
# Reguły
# =========================================================================

# -------------------------------------------------------------------------
# Reguły nieodwołujące się do plików
# -------------------------------------------------------------------------

.PHONY: all archive clean zadanie1 zadanie2 zadanie3

all: $(EXEC1A) $(EXEC1B) $(EXEC2A) $(EXEC2B) $(EXEC3A) $(EXEC3B) $(EXEC3C)


# -------------------------------------------------------------------------
# Reguły wzorcowe
# -------------------------------------------------------------------------

%.x: %.o
	$(CC) $(LDFLAGS) -o $@ $^ $(LDLIBS)

%.o: %.c
	$(CC) $(CFLAGS) -c -o $@ $<

# -------------------------------------------------------------------------
# Linkowanie prgramów z zadania 1
# -------------------------------------------------------------------------

$(EXEC1A) : $(ZAD1A).o $(PROCINFO)

$(EXEC1B) : $(ZAD1B).o $(PROCINFO)

# -------------------------------------------------------------------------
# Linkowanie prgramów z zadania 2
# -------------------------------------------------------------------------

$(EXEC2A) : $(ZAD2A).o $(PROCINFO)

$(ZAD2A).o : $(ZAD2A).c $(EXEC2B)

$(EXEC2B) : $(ZAD2B).o $(PROCINFO)

# -------------------------------------------------------------------------
# Linkowanie prgramów z zadania 3
# -------------------------------------------------------------------------

$(EXEC3B) : $(ZAD3B).o $(PROCINFO)

$(ZAD3C).o : $(ZAD3C).c $(EXEC2B)

# -------------------------------------------------------------------------
# Reguły kompilacji całych zadań
# -------------------------------------------------------------------------

zadanie1: $(EXEC1A) $(EXEC1B)

zadanie2: $(EXEC2A) $(EXEC2B)

zadanie3: $(EXEC3A) $(EXEC3B) $(EXEC3C)

# -------------------------------------------------------------------------
# Reguła archiwizująca cały Zestaw
# -------------------------------------------------------------------------

archive: clean
	(cd ../; tar -cvzf $(NAME)$(SURNAME)_$(MODULE).tar.gz  $(MODULE) )

# -------------------------------------------------------------------------
# Reguły czyszcząca pliki tymczasowe
# -------------------------------------------------------------------------

clean:
	$(RM) *.[ox]

# =========================================================================
