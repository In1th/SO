# =========================================================================
# Makefile
# =========================================================================
# autor: Mateusz Kruk, grupa 7.
# utworzony: 20.03.2021
# modyfikowany ostatnio: 31.03.2021
# =========================================================================

# =========================================================================
# Makrodefinicje
# =========================================================================

# -------------------------------------------------------------------------
# Nazwa zestawu
# -------------------------------------------------------------------------

MODULE := Zestaw03
NAME := Mateusz
SURNAME := Kruk

# -------------------------------------------------------------------------
# Nazwy zadań
# -------------------------------------------------------------------------

ZAD1 := obsluga
ZAD2 := wysylaj
ZAD3 := grupa

# -------------------------------------------------------------------------
# Nazwy plików wykonywalnych
# -------------------------------------------------------------------------

EXEC1 := $(ZAD1).x
EXEC2 := $(ZAD2).x
EXEC3 := $(ZAD3).x

# -------------------------------------------------------------------------
# Makrodefinicje kompilacji i linkowania
# -------------------------------------------------------------------------

CC := gcc
CFLAGS := -O3 -Wall
LDFLAGS := -s -lm
LDLIBS :=
PROCINFO := procinfo.o

# =========================================================================
# Reguły
# =========================================================================

# -------------------------------------------------------------------------
# Reguły nieodwołujące się do plików
# -------------------------------------------------------------------------

.PHONY: all archive clean clean_o

all: $(EXEC1) $(EXEC2) $(EXEC3) clean_o


# -------------------------------------------------------------------------
# Reguły wzorcowe
# -------------------------------------------------------------------------

%.x: %.o
	$(CC) $(LDFLAGS) -o $@ $^ $(LDLIBS)

%.o: %.c
	$(CC) $(CFLAGS) -c -o $@ $<

# -------------------------------------------------------------------------
# Linkowanie prgramów z zadania 1
# -------------------------------------------------------------------------

$(EXEC1) : $(ZAD1).o $(PROCINFO)

# -------------------------------------------------------------------------
# Linkowanie prgramów z zadania 2
# -------------------------------------------------------------------------

$(ZAD2).o : $(ZAD2).c $(EXEC1)

# -------------------------------------------------------------------------
# Linkowanie prgramów z zadania 3
# -------------------------------------------------------------------------

$(ZAD3).o : $(ZAD3).c $(EXEC1)

# -------------------------------------------------------------------------
# Reguła archiwizująca cały Zestaw
# -------------------------------------------------------------------------

archive: clean
	(cd ../; tar -cvzf $(NAME)$(SURNAME)_$(MODULE).tar.gz  $(MODULE) )

# -------------------------------------------------------------------------
# Reguła czyszcząca pliki tymczasowe
# -------------------------------------------------------------------------

clean:
	$(RM) *.[ox]

clean_o:
	$(RM) *.o

# =========================================================================
