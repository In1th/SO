# =========================================================================
# Makefile
# =========================================================================
# autor: Mateusz Kruk, grupa 7.
# utworzony: 20.04.2021
# modyfikowany ostatnio: 26.04.2021
# =========================================================================

# =========================================================================
# Makrodefinicje
# =========================================================================

# -------------------------------------------------------------------------
# Nazwa zestawu
# -------------------------------------------------------------------------

MODULE := Zestaw06
NAME := Mateusz
SURNAME := Kruk

# -------------------------------------------------------------------------
# Nazwy zadań
# -------------------------------------------------------------------------

LIB := sem
ZAD2 := semuse
ZAD3A := powielacz
ZAD3B := prog

# -------------------------------------------------------------------------
# Nazwy plików wykonywalnych
# -------------------------------------------------------------------------

EXEC1 := $(ZAD1).x
EXEC2 := $(ZAD2).x
EXEC3A := $(ZAD3A).x
EXEC3B := $(ZAD3B).x

# -------------------------------------------------------------------------
# Makrodefinicje kompilacji i linkowania
# -------------------------------------------------------------------------

CC := gcc -pthread
CFLAGS := -O3 -Wall
LDFLAGS := -L. -s -lm
LDLIBS := -lrt -lsem
LIB_CREATE := ar rv

# =========================================================================
# Reguły
# =========================================================================

# -------------------------------------------------------------------------
# Reguły nieodwołujące się do plików
# -------------------------------------------------------------------------

.PHONY: libsem.a all archive clean clean_o

all: libsem.a $(EXEC2) $(EXEC3A) clean_o


# -------------------------------------------------------------------------
# Reguły wzorcowe
# -------------------------------------------------------------------------

%.x: %.o
	$(CC) $(LDFLAGS) -o $@ $^ $(LDLIBS)

%.o: %.c
	$(CC) $(CFLAGS) -c -o $@ $<

# -------------------------------------------------------------------------
# Linkowanie prgramów z zadania 1
# -------------------------------------------------------------------------

libsem.a: $(LIB).o
	$(LIB_CREATE) $@ $<

$(LIB).o: $(LIB).c
	gcc -c $< -o $@

# -------------------------------------------------------------------------
# Linkowanie prgramów z zadania 2
# -------------------------------------------------------------------------

$(ZAD2).o : $(ZAD2).c libsem.a

# -------------------------------------------------------------------------
# Linkowanie prgramów z zadania 3
# -------------------------------------------------------------------------

$(ZAD3A).o : $(ZAD3A).c libsem.a $(EXEC3B) 

# -------------------------------------------------------------------------
# Reguła archiwizująca cały Zestaw
# -------------------------------------------------------------------------

archive: clean
	(cd ../; tar -cvzf $(NAME)$(SURNAME)_$(MODULE).tar.gz  $(MODULE) )

# -------------------------------------------------------------------------
# Reguła czyszcząca pliki tymczasowe
# -------------------------------------------------------------------------

clean:
	$(RM) *.[oxa]

clean_o:
	$(RM) *.o

# =========================================================================
