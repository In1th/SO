# =========================================================================
# Makefile
# =========================================================================
# autor: Mateusz Kruk, grupa 7.
# utworzony: 02.03.2021
# modyfikowany ostatnio: 17.03.2021
# =========================================================================

# =========================================================================
# Makrodefinicje
# =========================================================================

# -------------------------------------------------------------------------
# Nazwa zestawu
# -------------------------------------------------------------------------

MODULE := Zestaw01
NAME := Mateusz
SURNAME := Kruk

# -------------------------------------------------------------------------
# Nazwy zadań
# -------------------------------------------------------------------------

ZAD1 := procinfo
ZAD2 := kopiuj
ZAD3 := procesy
ZAD4 := lider

# -------------------------------------------------------------------------
# Nazwy plików wykonywalnych
# -------------------------------------------------------------------------

EXEC1 := $(ZAD1).x
EXEC2 := $(ZAD2).x
EXEC3 := $(ZAD3).x
EXEC4 := $(ZAD4).x

# -------------------------------------------------------------------------
# Makrodefinicje kompilacji i linkowania
# -------------------------------------------------------------------------

CC := gcc
CFLAGS := -O3 -Wall
LDFLAGS := -s -lm
LDLIBS := 

# =========================================================================
# Reguły
# =========================================================================

# -------------------------------------------------------------------------
# Reguły nieodwołujące się do plików
# -------------------------------------------------------------------------

.PHONY: all archive clean

all: $(EXEC1) $(EXEC2) $(EXEC3) $(EXEC4)


# -------------------------------------------------------------------------
# Reguły wzorcowe
# -------------------------------------------------------------------------

%.x: %.o
	$(CC) $(LDFLAGS) -o $@ $^ $(LDLIBS)

%.o: %.c
	$(CC) $(CFLAGS) -c -o $@ $<

# -------------------------------------------------------------------------
# Reguły łączenia wieloplikowego zadania 1.
# -------------------------------------------------------------------------

$(EXEC1): main.o $(ZAD1).o
$(ZAD1).o: $(ZAD1).c $(ZAD1).h

# -------------------------------------------------------------------------
# Reguły łączenia wieloplikowego zadania 3.
# -------------------------------------------------------------------------

$(EXEC3): $(ZAD3).o $(ZAD1).o

# -------------------------------------------------------------------------
# Reguły łączenia wieloplikowego zadania 4.
# -------------------------------------------------------------------------

$(EXEC4): $(ZAD4).o $(ZAD1).o

# -------------------------------------------------------------------------
# Reguła archiwizująca cały Zestaw
# -------------------------------------------------------------------------

archive: clean
	(cd ../; tar -cvzf $(NAME)$(SURNAME)_$(MODULE).tar.gz  $(MODULE) )

# -------------------------------------------------------------------------
# Reguła czyszcząca pliki tymczasowe
# -------------------------------------------------------------------------

clean:
	$(RM) *.[ox]

# =========================================================================